<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>



    /* initialize jsPsych */
    var jsPsych = initJsPsych({
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });

    /* create timeline */
    var timeline = [];

  /* preload images */
  var image_files = ['img/blue.png', 'img/orange.png', 'img/green.png']; // Add any extra stimuli here
  var preload = {
    type: jsPsychPreload,
    images: image_files,
  };
  timeline.push(preload);

    /* define welcome message trial */
    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);

    // /*define horisontal 3 trial*/

    var planetResonseFirst = {
      type: 'planet-respone',
      stimulus: 'img/blue.png',
      stimulus_select:'img/selectring.png',
      prompt: ['Planet A','Planet B','Planet C'],
      ship_stimulus: 'img/blue.png',
      show_ship: false,
      ship_attack_damage: 5,
      ship_hostile_idx: pun_planet_side,
      block_duration: block_duration,
      reset_planet_wait: 1000,
      shield_charging_time: 3000,
      ship_attack_time: 6000,
      feedback_duration: feedback_duration,
      probability_trade: probability_trade,
      probability_ship: probability_ship,
      probability_shield: probability_shield,

    var planet_noship = {
            type: 'planet-response',
            stimulus: stim_list,
            stimulus_select:'img/selectring.png',
            prompt: ['Planet A','Planet B','Planet TREE'],
            ship_stimulus: ship_list,
            show_ship: false,
            ship_attack_damage: ship_attack_damage,
            ship_hostile_idx: pun_planet_side,
            block_duration: block_duration,
            reset_planet_wait: 1000,
            shield_charging_time: 3000,
            ship_attack_time: 6000,
            feedback_duration: feedback_duration,
            probability_trade: probability_trade,
            probability_ship: probability_ship,
            probability_shield: probability_shield,
            data: {
                phase: 'phase1',
                block_type: 'planet_noship',
                block_number: block_number,
                trial_number: trial_number
            },
            on_start: function(trial) {
                trial.data.points = points;
                trial.data.block_number = block_number;
                trial.data.trial_number = trial_number;
            },
            on_finish: function(data){
                points = data.points_total;
                trial_number = data.trial_number;
                trial_number++;
                // script for continuous response block

    /* define instructions trial */
    var instructions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p>In this experiment, a circle will appear in the center 
        of the screen.</p>
      `,
      post_trial_gap: 2000
    };
    timeline.push(instructions);

    /* define trial stimuli array for timeline variables */
    var test_stimuli = [
      { stimulus: "img/blue.png",  correct_response: 'f'},
      { stimulus: "img/orange.png",  correct_response: 'j'},
      { stimulus: "img/green.png",  correct_response: 'g'}
    ];

    /* define fixation and test trials */
    var fixation = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: "NO_KEYS",
      trial_duration: function(){
        return jsPsych.randomization.sampleWithoutReplacement([250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0];
      },
      data: {
        task: 'fixation'
      }
    };

    var test = {
      type: jsPsychImageKeyboardResponse,
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: ['f', 'j','g'],
      data: {
        task: 'response',
        correct_response: jsPsych.timelineVariable('correct_response')
      },
      on_finish: function(data){
        data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
      }
    };

    /* define test procedure */
    var test_procedure = {
      timeline: [fixation, test],
      timeline_variables: test_stimuli,
      repetitions: 5,
      randomize_order: true
    };
    timeline.push(test_procedure);

    /* define debrief */
    var debrief_block = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {

        var trials = jsPsych.data.get().filter({task: 'response'});
        var correct_trials = trials.filter({correct: true});
        var accuracy = Math.round(correct_trials.count() / trials.count() * 100);
        var rt = Math.round(correct_trials.select('rt').mean());

        return `<p>You responded correctly on ${accuracy}% of the trials.</p>
          <p>Your average response time was ${rt}ms.</p>
          <p>Press any key to complete the experiment. Thank you!</p>`;

      }
    };
    timeline.push(debrief_block);

    /* start the experiment */
    jsPsych.run(timeline);

  </script>
</html>